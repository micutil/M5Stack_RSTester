# M5Stack RSTester
RSTesterは、双葉電子工業さんのRS304系のサーボの動作テスト、ID変更および、各種設定の表示や変更を行う為の、M5Stackのプログラムおよび、RS304系のサーボを接続するためのアダプターです。

どのようなプログラムなのかは、以下の動画を観て頂けると理解しやすいかと思います。<br>
[![preview](images/preview01s.jpg)](https://www.youtube.com/watch?v=g7JMcP97mWo)


## インストール

### ① M5StackのmicroSDに入れるもの
1. 同梱のファイルの中にmicroSDフォルダがあります、その中にファイルがいくつか入ってます。それらのファイルをmicroSDにコピーします。RSTester.binというファイルがRSTesterのプログラムになります。jpgやjsonのフォルダに入っているファイルはメニュプログラムが使うデータです。
もし、microSDの中に、既にjpgフォルダや、jsonフォルダがある場合は、それぞれの中に入っているファイルをコピーするようにして下さい。またバージョンのファイルで置き換えてしまわない様にコピーする際は、修正日を比べてコピーする様にして下さい。
2. 次に、RSTesterが使っているフォントをダウンロードしてmicroSDに入れます。ブラウザで、https://git.io/fjYst を開きます。
3. 「Clone or download」でDownload ZIPを選び、ダウンロードする。
4. ダウンロードしたファイルの中に、fontbinというフォルダがあり、その中に、FONT.BIN, FONTLCD.BINというファイルがあるので、これら２つのファイルを今回用意したmicroSDにコピーします。
5. これでM5Stackに入れるmicroSDの作成は終了です。このmicroSDをM5Stackに入れて下さい。以下の図はコピーしたのちのmicroSDの中のファイルのイメージ図です（バージョンアップにより改変がありますので、実際には以下の図と多少違いがあります）。


### ② USBドライバーをインストールする
M5Stackをコンピュータと繋いで、プログラムの転送など通信するためには、Silicon LabsのUSBDriverをインストールする必要があります。もしまだインストールしてなければ以下のサイトを参考にしてインストールして下さい。

https://docs.m5stack.com/#/ja/related_documents/establish_serial_connection

なお、Macの場合、インストールしただけではセキュリティが通ってないので、インストール後、環境設定のセキュリティとプライバシーの一般で、インストールしたドライバーの許可をして下さい。


### ③ M5Burner_Micで、M5StackにSD-Menuをインストールする
M5Burner_MicというプログラムでSD-MenuをM5Stackにインストールします。すでにSD-MenuまたはLovyanLauncherをインストールしてある場合はこのステップは必要ありません。
1. M5Stackに付いてきたUSB-CケーブルでパソコンとM5Stackを繋げて下さい。
2. https://github.com/micutil/M5Burner_Mic の「Download here」の所でM5Burner_Micをダウンロードし、解凍して下さい。M5Burner_Micフォルダはお好みの場所に入れて下さい。
3. M5Burner_Micをダブルクリックして起動します。
4. USBシリアルポートをM5Stackのポートに設定します。
- Macの場合はポートに名前がつくので「SLAB_USBtoUART」という名前のポートを選んで下さい。
- Windowsの場合は、COM3とか、COM4とかの名前になっています。ひとつしか表示されてなかったら、それがM5Stackのポートでしょう。もしいくつか表示されているようだったら、コントロールパネルから、デバイスマネージャーのポートをみて番号を確認して下さい。例えば以下の図の場合だとCOM4であるということになります。
5. プリセット（Priset）のポップアップメニューで「SD-Menu」の最新版を選択します。
6. 「開始」ボタンをクリックすると、プログラムの転送が開始します。
7. プログラムの転送が終わるとM5Stackがリセットされ、インストールしたSD-Menuが起動します。
8. M5StackのCボタン（右）を何回か押して、RSTesterを選択し、Bボタン（中央）のボタンを押すと、RSTesterが起動します。
9. 再度、メニューを表示する場合は、Aボタン（左）を押しながらリセットボタン（左上側面）を押すとSD-Menuが起動します。

## 接続
M5Stackとサーボをジャンパーワイヤなどでつなぎます。

	M5Stack		RS304系サーボ（写真の場合上から）
	T2		…	シグナル
	5V		…	パワー
	GND		…	グランド

1. 写真のようなコネクターを作る場合は、ROBOMICのブログ
http://micono.cocolog-nifty.com/blog/2013/04/rs308md-f205.html
を参考にして下さい。

2. M5Stack RSTesterアンダプターについて


注意：複数のサーボがつながっている場合、パソコンからのUSBでは電流不足になる場合があるので、モバイルバッテリーをM5Stackにつなげて行ってください。



## RSTesterの簡単な操作方法
1. TobozoLauncher, LovyanLauncherなどで、RSTesterを起動します。
2. A: 動作テスト、B: ID変更、C: 各種設定（の表示と変更）の機能があります。

### A: 動作テスト

### B: ID変更

### C: 各種設定

## 設定変更
コンプライアンスマージン、コンプライアンススロープ、パンチ、サーボのIDの順で設定していきます。MSPChangerが起動し、両端のボタンで設定値を変えて、真ん中のOKボタンを押すと、次、次と、設定項目が変更していきます。
IDは255を選ぶと、全てのサーボが対象になりますので、複数のサーボがつながっているサーボすべて同じ値に変更する時や、サーボのIDがわからない場合は、255を選ぶといいでしょう。

サーボIDまで設定が進むと、次にボタンが、「やり直し」、「書換え」、「接続調べ」に変わります。設定をもう一度やり直したい場合は、「やり直し」を押して最初から設定し直して下さい。

●接続テスト
「接続調べ」を押すとサーボが10度ごと回転しますので、正しく接続されていてサーボが動くか確認して下さい。

●変更を保存
設定値は変更しただけで、ROMに書き込まれていませんので、「書換え」ボタンを押して書き換えを行って下さい。この時に電源が切れるとサーボが壊れるかもしれませんのでちゃんと電源を接続して行って下さい。

問い合わせ
micono@mac.com
同梱されている書類すべてに関して、無断転載、掲載、改変を禁じます。
これらを使ったことにより生じるいかなるトラブルに関しても自己責任においておこなって下さい。
